<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=lc_KqZAnJZMO5HHpESLXOyBT44YHZh5XveqtkptPAQM);ol.lst-kix_list_1-3{list-style-type:none}ol.lst-kix_list_1-4{list-style-type:none}.lst-kix_list_2-6>li:before{content:"-  "}.lst-kix_list_2-7>li:before{content:"-  "}ol.lst-kix_list_1-5{list-style-type:none}ol.lst-kix_list_1-6{list-style-type:none}ol.lst-kix_list_1-0{list-style-type:none}.lst-kix_list_2-4>li:before{content:"-  "}.lst-kix_list_2-5>li:before{content:"-  "}.lst-kix_list_2-8>li:before{content:"-  "}ol.lst-kix_list_1-1{list-style-type:none}ol.lst-kix_list_1-2{list-style-type:none}.lst-kix_list_1-1>li{counter-increment:lst-ctn-kix_list_1-1}.lst-kix_list_3-0>li:before{content:"-  "}.lst-kix_list_3-1>li:before{content:"-  "}.lst-kix_list_3-2>li:before{content:"-  "}ul.lst-kix_list_3-7{list-style-type:none}ul.lst-kix_list_3-8{list-style-type:none}ol.lst-kix_list_1-8.start{counter-reset:lst-ctn-kix_list_1-8 0}ul.lst-kix_list_3-1{list-style-type:none}.lst-kix_list_3-5>li:before{content:"-  "}ul.lst-kix_list_3-2{list-style-type:none}.lst-kix_list_3-4>li:before{content:"-  "}ul.lst-kix_list_3-0{list-style-type:none}ol.lst-kix_list_1-5.start{counter-reset:lst-ctn-kix_list_1-5 0}ol.lst-kix_list_1-7{list-style-type:none}.lst-kix_list_3-3>li:before{content:"-  "}ul.lst-kix_list_3-5{list-style-type:none}.lst-kix_list_1-7>li{counter-increment:lst-ctn-kix_list_1-7}ol.lst-kix_list_1-8{list-style-type:none}ul.lst-kix_list_3-6{list-style-type:none}ul.lst-kix_list_3-3{list-style-type:none}ul.lst-kix_list_3-4{list-style-type:none}.lst-kix_list_3-8>li:before{content:"-  "}.lst-kix_list_3-6>li:before{content:"-  "}.lst-kix_list_3-7>li:before{content:"-  "}ol.lst-kix_list_1-7.start{counter-reset:lst-ctn-kix_list_1-7 0}.lst-kix_list_1-2>li{counter-increment:lst-ctn-kix_list_1-2}.lst-kix_list_1-5>li{counter-increment:lst-ctn-kix_list_1-5}.lst-kix_list_1-8>li{counter-increment:lst-ctn-kix_list_1-8}ol.lst-kix_list_1-4.start{counter-reset:lst-ctn-kix_list_1-4 0}ol.lst-kix_list_1-1.start{counter-reset:lst-ctn-kix_list_1-1 0}.lst-kix_list_1-4>li{counter-increment:lst-ctn-kix_list_1-4}ol.lst-kix_list_1-6.start{counter-reset:lst-ctn-kix_list_1-6 0}ol.lst-kix_list_1-3.start{counter-reset:lst-ctn-kix_list_1-3 0}ul.lst-kix_list_2-8{list-style-type:none}ol.lst-kix_list_1-2.start{counter-reset:lst-ctn-kix_list_1-2 0}ul.lst-kix_list_2-2{list-style-type:none}.lst-kix_list_1-0>li:before{content:"" counter(lst-ctn-kix_list_1-0,decimal) ". "}ul.lst-kix_list_2-3{list-style-type:none}ul.lst-kix_list_2-0{list-style-type:none}ul.lst-kix_list_2-1{list-style-type:none}ul.lst-kix_list_2-6{list-style-type:none}.lst-kix_list_1-1>li:before{content:"" counter(lst-ctn-kix_list_1-1,lower-latin) ". "}.lst-kix_list_1-2>li:before{content:"" counter(lst-ctn-kix_list_1-2,lower-roman) ". "}ul.lst-kix_list_2-7{list-style-type:none}ul.lst-kix_list_2-4{list-style-type:none}ul.lst-kix_list_2-5{list-style-type:none}.lst-kix_list_1-3>li:before{content:"" counter(lst-ctn-kix_list_1-3,decimal) ". "}.lst-kix_list_1-4>li:before{content:"" counter(lst-ctn-kix_list_1-4,lower-latin) ". "}ol.lst-kix_list_1-0.start{counter-reset:lst-ctn-kix_list_1-0 0}.lst-kix_list_1-0>li{counter-increment:lst-ctn-kix_list_1-0}.lst-kix_list_1-6>li{counter-increment:lst-ctn-kix_list_1-6}.lst-kix_list_1-7>li:before{content:"" counter(lst-ctn-kix_list_1-7,lower-latin) ". "}.lst-kix_list_1-3>li{counter-increment:lst-ctn-kix_list_1-3}.lst-kix_list_1-5>li:before{content:"" counter(lst-ctn-kix_list_1-5,lower-roman) ". "}.lst-kix_list_1-6>li:before{content:"" counter(lst-ctn-kix_list_1-6,decimal) ". "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_list_2-0>li:before{content:"-  "}.lst-kix_list_2-1>li:before{content:"-  "}.lst-kix_list_1-8>li:before{content:"" counter(lst-ctn-kix_list_1-8,lower-roman) ". "}.lst-kix_list_2-2>li:before{content:"-  "}.lst-kix_list_2-3>li:before{content:"-  "}ol{margin:0;padding:0}table td,table th{padding:0}.c6{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:156pt;border-top-color:#000000;border-bottom-style:solid}.c28{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:86.2pt;border-top-color:#000000;border-bottom-style:solid}.c31{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:86.2pt;border-top-color:#000000;border-bottom-style:solid}.c3{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:141pt;border-top-color:#000000;border-bottom-style:solid}.c35{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:86.2pt;border-top-color:#000000;border-bottom-style:solid}.c22{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:234pt;border-top-color:#000000;border-bottom-style:solid}.c19{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:234pt;border-top-color:#000000;border-bottom-style:solid}.c30{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:73.5pt;border-top-color:#000000;border-bottom-style:solid}.c7{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;border-left-style:solid;border-bottom-width:0pt;width:234pt;border-top-color:#000000;border-bottom-style:solid}.c26{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:238.5pt;border-top-color:#000000;border-bottom-style:solid}.c9{padding-top:18pt;padding-bottom:4pt;line-height:1.1500000000000001;page-break-after:avoid;orphans:2;widows:2;text-align:justify;height:16pt}.c2{padding-top:0pt;padding-bottom:4pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:justify;height:11pt}.c17{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Spectral";font-style:normal}.c16{padding-top:18pt;padding-bottom:4pt;line-height:1.1500000000000001;page-break-after:avoid;orphans:2;widows:2;text-align:justify}.c33{padding-top:20pt;padding-bottom:6pt;line-height:1.1500000000000001;page-break-after:avoid;orphans:2;widows:2;text-align:justify}.c14{color:#666666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:15pt;font-family:"Arial";font-style:normal}.c0{padding-top:18pt;padding-bottom:6pt;line-height:1.1500000000000001;page-break-after:avoid;orphans:2;widows:2;text-align:justify}.c5{padding-top:0pt;padding-bottom:16pt;line-height:1.1500000000000001;page-break-after:avoid;orphans:2;widows:2;text-align:justify}.c39{-webkit-text-decoration-skip:none;color:#000000;text-decoration:underline;vertical-align:baseline;text-decoration-skip-ink:none;font-size:20pt;font-style:normal}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Spectral";font-style:normal}.c10{padding-top:0pt;padding-bottom:4pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:justify}.c29{padding-top:0pt;padding-bottom:0pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:justify}.c12{text-decoration-skip-ink:none;font-family:"Spectral";-webkit-text-decoration-skip:none;font-weight:700;text-decoration:underline}.c13{color:#000000;text-decoration:none;vertical-align:baseline;font-size:16pt;font-style:normal}.c15{margin-left:18pt;padding-top:3pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c11{color:#000000;text-decoration:none;vertical-align:baseline;font-size:20pt;font-style:normal}.c20{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;font-weight:700;text-decoration:underline}.c18{color:#000000;vertical-align:baseline;font-size:11pt;font-style:normal}.c38{margin-left:-49.5pt;border-spacing:0;border-collapse:collapse;margin-right:auto}.c4{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c24{border-spacing:0;border-collapse:collapse;margin-right:auto}.c36{color:#000000;text-decoration:none;vertical-align:baseline;font-size:11pt}.c37{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c32{padding:0;margin:0}.c23{color:inherit;text-decoration:inherit}.c8{font-weight:400;font-family:"Spectral"}.c21{margin-left:36pt;padding-left:0pt}.c34{height:11pt}.c25{font-style:italic}.c27{height:0pt}.title{padding-top:0pt;color:#000000;font-size:20pt;padding-bottom:3pt;font-family:"Spectral";line-height:1.1500000000000001;page-break-after:avoid;orphans:2;widows:2;text-align:justify}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.1500000000000001;page-break-after:avoid;orphans:2;widows:2;text-align:justify}li{color:#000000;font-size:11pt;font-family:"Spectral"}p{margin:0;color:#000000;font-size:11pt;font-family:"Spectral"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Spectral";line-height:1.1500000000000001;page-break-after:avoid;orphans:2;widows:2;text-align:justify}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Spectral";line-height:1.1500000000000001;page-break-after:avoid;orphans:2;widows:2;text-align:justify}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Spectral";line-height:1.1500000000000001;page-break-after:avoid;orphans:2;widows:2;text-align:justify}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Spectral";line-height:1.1500000000000001;page-break-after:avoid;orphans:2;widows:2;text-align:justify}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Spectral";line-height:1.1500000000000001;page-break-after:avoid;orphans:2;widows:2;text-align:justify}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Spectral";line-height:1.1500000000000001;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:justify}</style></head><body class="c37 doc-content"><div><p class="c2"><span class="c1"></span></p></div><h1 class="c33" id="h.gjdgxs"><span class="c8 c39">Peripheral Bus Interface Generation 1</span></h1><p class="c10"><span class="c25">N.B: This document is for Peripheral Bus Interface Generation 1. From here on, PBI or Peripheral Bus Interface means Peripheral Bus Interface Generation 1.</span></p><p class="c15 c34"><span class="c1"></span></p><p class="c15"><span><a class="c23" href="#h.30j0zll">Introduction to Peripheral Bus Interface&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2</a></span></p><p class="c15"><span><a class="c23" href="#h.3znysh7">Peripheral Bus Interface Clock and Synchronisation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</a></span></p><p class="c15"><span><a class="c23" href="#h.tyjcwt">Peripheral Bus Interface Pinout&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4</a></span></p><p class="c15"><span><a class="c23" href="#h.1t3h5sf">Reserved Peripheral Bus Interface Commands&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5</a></span></p><p class="c15"><span><a class="c23" href="#h.26in1rg">Peripheral Bus Interface Addressing Standards&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7</a></span></p><p class="c15"><span><a class="c23" href="#h.lnxbz9">Required CPU Computation Capabilities&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8</a></span></p><p class="c15"><span><a class="c23" href="#h.35nkun2">Peripheral Bus Interface Over Serial Link&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9</a></span></p><p class="c15"><span><a class="c23" href="#h.1ksv4uv">Implementing PBI on Your System&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10</a></span></p><hr style="page-break-before:always;display:none;"><p class="c15 c34"><span class="c1"></span></p><h2 class="c0" id="h.30j0zll"><span class="c13 c8">Introduction to Peripheral Bus Interface</span></h2><p class="c10"><span class="c8">PBI is a simplex standard for addressing multiple peripherals on the same lane. Functionally, it&rsquo;s most similar to the old PCI (Peripheral Component Interconnect) protocol. PBI uses 8 address bits for each peripheral</span><span>. This allows it to support 256 addresses, but 0x00 and 0xFF mustn&#39;t be used (see Peripheral Bus Interface Addressing Standards) </span><span class="c8">and 12 data bits. All data is sent in parallel form, to reduce complexity and increase transfer speed. </span><span class="c1">Each kind of peripheral (such as GPU, sound card, keyboard) has its own relevant and unique PBI address.</span></p><p class="c2"><span class="c1"></span></p><p class="c10"><span class="c8">PBI is a data-only protocol. It doesn&rsquo;t power the components placed on it, which need their own power sources. The protocol requires </span><span>either </span><span class="c8">21 </span><span>or 23 </span><span class="c8">parallel</span><span>&nbsp;signals</span><span class="c8">. </span><span>For the spacing, arrangement and function of individual pins, </span><span class="c1">see the PBI Pinout section. </span></p><p class="c2"><span class="c1"></span></p><hr style="page-break-before:always;display:none;"><h2 class="c9" id="h.1fob9te"><span class="c13 c8"></span></h2><h2 class="c16" id="h.3znysh7"><span class="c8 c13">Peripheral Bus Interface Clock and Synchronisation</span></h2><p class="c10"><span class="c1">Other than the 12 data pins and the 8 address pins, the last wire is for the clock. The clock is set by the CPU as an output only pin. It&rsquo;s impossible for the CPU to relinquish control of the output line. However, there is no requirement for PBI peripherals to synchronise against it if it&rsquo;s not a necessary action. The PBI clock speed is set by the CPU - e.g. on the TE16100 it&rsquo;s 50MHz, which means the maximum transfer speed is 50 MT/s. There is no need for acknowledgement packets on the protocol, but drivers can implement them for their peripherals, a simplified process being:</span></p><ol class="c32 lst-kix_list_1-0 start" start="1"><li class="c29 c21 li-bullet-0"><span>S</span><span class="c8">end command</span></li><li class="c29 c21 li-bullet-0"><span>D</span><span class="c8">isable clock</span></li><li class="c29 c21 li-bullet-0"><span>C</span><span class="c8">hange to input mode</span></li><li class="c29 c21 li-bullet-0"><span>E</span><span class="c8">nable clock</span></li><li class="c29 c21 li-bullet-0"><span>Re</span><span class="c8">ad from PBI</span></li><li class="c29 c21 li-bullet-0"><span>C</span><span class="c8">opy to accumulator</span></li><li class="c10 c21 li-bullet-0"><span>C</span><span class="c8">heck if zero with JNZ and JPZ.</span></li></ol><p class="c2"><span class="c1"></span></p><hr style="page-break-before:always;display:none;"><h2 class="c9" id="h.2et92p0"><span class="c13 c8"></span></h2><h2 class="c16" id="h.tyjcwt"><span class="c13 c8">Peripheral Bus Interface Pinout</span></h2><p class="c10"><span>The PBI pinout is standardised so that all components can be designed to use the same connectors. </span><span class="c1">The standard pinout for a PBI component is to have (from left to right) the address pins on the left, followed by a gap, then the data pins. As a minimum, this gives the following PBI pinout:</span></p><p class="c10"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 361.00px; height: 160.00px;"><img alt="" src="images/image12.png" style="width: 624.00px; height: 350.99px; margin-left: -122.00px; margin-top: -139.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span>This is the most simple pinout for a PBI expansion card. There are also two other standardised pins. The first is </span><img src="images/image1.png"><span>&nbsp;(Chip Enable). When pulled high, this overrides the address (turning any address into the correct one). This allows the motherboard to control PBI addresses instead of the CPU. The second pin is </span><img src="images/image2.png"><span>&nbsp;(Disable Address Line). When pulled high, this disables the functionality of the address pins (giving addressign control entirely to the </span><img src="images/image1.png"><span>&nbsp;pin). Both of these pins are optional and not a required feature of the motherboard - but the motherboard must pull </span><img src="images/image1.png"><span>&nbsp;and </span><img src="images/image2.png"><span class="c1">&nbsp;LOW if it doesn&rsquo;t control the peripheral with them, The full pinout looks like this:</span></p><p class="c10"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 385.50px; height: 173.36px;"><img alt="" src="images/image14.png" style="width: 812.66px; height: 457.69px; margin-left: -175.81px; margin-top: -174.55px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span>Pins should have a 2.54 mm pitch, and receptacles must be 1.90 mm long. </span><span class="c8">The </span><span>intended gaps (between A7 and D0, and D11 and CLK) are the same as having a pin with no connection. The gaps are part of the standardised connector system in order to </span><span class="c8">stop a </span><span>peripheral </span><span class="c8">being</span><span>&nbsp;inserted</span><span class="c8">&nbsp;in the wrong direction</span><span>. Splitting the pins into groups with the same function </span><span class="c1">makes the pinout more intuitive to debug the hardware. </span></p><h2 class="c0" id="h.1t3h5sf"><span class="c13 c8">Reserved Peripheral Bus Interface Commands</span></h2><p class="c5 subtitle" id="h.4d34og8"><span class="c14">Built-in Acknowledgement</span></p><p class="c10"><span>PBI integrates a standard code that can be used to check if a device is working. I</span><span class="c8">f the data 0x0F0 is sent to the device (and the device is ex</span><span>pecting a command cycle, if applicable)</span><span class="c1">, it responds with a standard acknowledgement that shows it is working or its status. Below is the format of this response, which is used to make sure the peripheral is working correctly. </span></p><p class="c10"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c10"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 243.65px; height: 90.50px;"><img alt="" src="images/image13.png" style="width: 1086.00px; height: 610.83px; margin-left: -0.00px; margin-top: -287.14px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c12 c18">ID Cycle:</span></p><p class="c10"><span class="c1">12 bits for the ID. This is set as a way of identifying the chip connected to the bus.</span></p><p class="c2"><span class="c12 c18"></span></p><p class="c10"><span class="c12 c18">Addr Cycle:</span></p><p class="c10"><span class="c8">The address the chip is placed at on the PBI bus. This is a confirmation, and can be used to check both the CPU and the peripheral agree on the address being set. If the </span><img src="images/image2.png"><span class="c8">&nbsp;line is high, and the component is being addressed through </span><img src="images/image1.png"><span class="c8">, then the response will be 0x000. This is a way of determining whether </span><img src="images/image1.png"><span class="c1">&nbsp;is being used.</span></p><p class="c2"><span class="c12 c18"></span></p><p class="c10"><span class="c12">ACK Cycle:</span></p><p class="c10"><span class="c8">A positive (all ok) acknowledgement is a non-zero response. This indicates the component is working properly. If the response is zero, there is an error with the hardware / software on the component. Drivers designed for PBI components should contain a function which checks for this acknowledgment. </span><span class="c1">A non-zero ACK can also be used as an error code, such that sending 0x030 means error 0x030 - providing a reason as to the error.</span></p><p class="c2"><span class="c1"></span></p><p class="c5 subtitle" id="h.2s8eyo1"><span class="c14">No Operation</span></p><p class="c10"><span class="c1">If, at any point, no data is sent on the bus, then the bus will have the command 0x000h. If this is built into the instruction set of a peripheral as a command, then data being turned off, or an address different to that of the peripheral, will cause the 0x000h to be executed as a command. Therefore, the code 0x000h is not to be used as a command.</span></p><p class="c2"><span class="c1"></span></p><p class="c5 subtitle" id="h.17dp8vu"><span class="c14">Halt Operation</span></p><p class="c10"><span class="c1">If the code 0xFFFh is sent on the bus to a peripheral as a command, it should be treated like a HALT operation, and the peripheral should stop executing commands and reading data.</span></p><p class="c2"><span class="c1"></span></p><p class="c5 subtitle" id="h.3rdcrjn"><span class="c14">Reset (Optional):</span></p><p class="c10"><span>This code is optional - a peripheral doesn&rsquo;t have to implement it. However, whether it does or doesn&rsquo;t, it&rsquo;s documentation and drivers should make it clear if the command is present. The command to reset the peripheral completely is 0x00Dh. It&rsquo;s good practice that a peripheral should send an acknowledgement after the reset is complete.</span><hr style="page-break-before:always;display:none;"></p><h2 class="c16" id="h.26in1rg"><span class="c13 c8">Peripheral Bus Interface Addressing Standards</span></h2><p class="c10"><span class="c1">As discussed previously, each peripheral has an address between 0x01 and 0xFE (with 0x00 and 0xFF reserved). Each type of peripheral should have a corresponding address, to avoid conflicting addresses for different classes of peripherals. The current table is shown below:</span></p><a id="t.46022b69419171de037b805403a6b6059b5b190b"></a><a id="t.0"></a><table class="c24"><tr class="c27"><td class="c19" colspan="1" rowspan="1"><p class="c4"><span class="c17">Peripheral Class</span></p></td><td class="c35" colspan="1" rowspan="1"><p class="c4"><span class="c17">PBI Address</span></p></td></tr><tr class="c27"><td class="c22" colspan="1" rowspan="1"><p class="c4"><span class="c1">GPU</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c4"><span class="c1">0x01</span></p></td></tr><tr class="c27"><td class="c22" colspan="1" rowspan="1"><p class="c4"><span class="c1">EEPROM / Flash / Secondary Storage / BIOS</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c4"><span class="c1">0x02</span></p></td></tr><tr class="c27"><td class="c22" colspan="1" rowspan="1"><p class="c4"><span class="c1">Keyboard HID</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c4"><span class="c1">0x03</span></p></td></tr><tr class="c27"><td class="c22" colspan="1" rowspan="1"><p class="c4"><span class="c1">Mouse HID</span></p></td><td class="c28" colspan="1" rowspan="1"><p class="c4"><span class="c1">0x04</span></p></td></tr><tr class="c27"><td class="c7" colspan="1" rowspan="1"><p class="c4"><span class="c1">Sound &amp; Audio Unit</span></p></td><td class="c31" colspan="1" rowspan="1"><p class="c4"><span class="c1">0x05</span></p></td></tr></table><p class="c2"><span class="c1"></span></p><p class="c10"><span>If both a Mouse HID and Keyboard HID is present on one peripheral card, it should use the PBI address 0x03 (Keyboard HID)</span><hr style="page-break-before:always;display:none;"></p><h2 class="c16" id="h.lnxbz9"><span class="c13 c8">Required CPU Computation Capabilities</span></h2><p class="c10"><span class="c1">The CPU requires a series of instructions to handle PBI, as well as two registers for the PBI lane&rsquo;s hardware. The registers needed are:</span></p><ul class="c32 lst-kix_list_3-0 start"><li class="c29 c21 li-bullet-0"><span>Peripheral Bus Interface Generation 1 Address Register (</span><span>PBIG1AR</span><span>) - 8 bits</span></li><li class="c10 c21 li-bullet-0"><span>Peripheral Bus Interface Generation 1 Data Register (</span><span>PBIG1DR</span><span>) - 12 bits</span></li></ul><p class="c10"><span>The </span><span>PBIG1AR</span><span class="c1">&nbsp;register should always output its address - there&rsquo;s no need to disable it. The data register may be disabled (high impedance), or enabled, until data is sent.</span></p><p class="c10"><span class="c1">There are a set of OPCODES which are recommended for the CPU to efficiently deal with PBI. These are:</span></p><p class="c2"><span class="c1"></span></p><ul class="c32 lst-kix_list_2-0 start"><li class="c29 c21 li-bullet-0"><span>PBIA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set the </span><span>PBIG1AR</span><span>&nbsp;(change PBI address)</span></li><li class="c21 c29 li-bullet-0"><span>PBID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Output data onto the PBI lane, or read data into </span><span>PBIG1DR</span><span>.</span></li><li class="c29 c21 li-bullet-0"><span>PBIM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Change the mode from read to write</span></li><li class="c10 c21 li-bullet-0"><span>PBIC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Change the PBI Clock (disabling it - tying it LOW or enabling it - normal operation)*</span></li></ul><p class="c10"><span class="c12 c18">An Explanation Of PBIC</span></p><p class="c10"><span class="c1">PBIC is used to stop the PBI clock from operating. This is used if the peripheral is expecting data on the next clock cycle, but moving data to the data register before outputting it will take multiple clock cycles. Because the enabling of the PBIC is negative edge, it can be enabled and the next command be PBD, outputting the new value with the clock active. This is shown below:</span></p><p class="c2"><span class="c1"></span></p><p class="c10"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 305.86px; height: 123.94px;"><img alt="" src="images/image15.png" style="width: 1247.41px; height: 698.36px; margin-left: -0.00px; margin-top: -341.11px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c1">This allows data to be moved around the CPU while the PBI is frozen and waits for the next data set, which can be sent whenever the necessary calculations have taken place.</span></p><hr style="page-break-before:always;display:none;"><p class="c2"><span class="c1"></span></p><h2 class="c0" id="h.35nkun2"><span class="c13 c8">Peripheral Bus Interface Over Serial Link</span></h2><p class="c10"><span class="c1">Serial Peripheral Bus interface is a way of using PBI on a CPU with very limited IO pins. The parallel data internally is converted to serial form and outputted, before being converted back into parallel. This is reasonably complicated, because it requires both serial to parallel and parallel to serial converters on either side of the IO pins. The serial form has a waveform like below:</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 121.33px;"><img alt="" src="images/image10.png" style="width: 624.00px; height: 121.33px; margin-left: -0.00px; margin-top: -0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c25">(example data format - not actual bus)</span></p><p class="c10"><span>If the clock is high, data is read - a LOW data line indicates a 0 while a HIGH data line represents a 1. In the above scenario, the data sent is 1001010110. One of these serial lines is needed for the PBI address, while another is needed for the data. There is also a PBI clock pin and a pin for </span><img src="images/image3.png"><span>. This gives a total of 4 I/O pins and 1 O pin to use PBI Serial Mode. PBI serial mode should be seen as a &ldquo;last resort&rdquo; - if there is no way or possibility of a parallel bus being used. It will significantly slow the system down. It is the responsibility of the northbridge on the motherboard to use the R/W flag (</span><img src="images/image3.png"><span class="c1">), in order to select the appropriate shift register combinations. The table below illustrates this:</span></p><p class="c10"><span class="c8 c25 c36">SIPO = Serial In Parallel Out PISO = Parallel in Serial Out</span></p><a id="t.d47721e0f894f04449c35893d09484ffe5885a80"></a><a id="t.1"></a><table class="c24"><tr class="c27"><td class="c30" colspan="1" rowspan="1"><p class="c4"><span class="c1">Serial Line:</span></p></td><td class="c26" colspan="1" rowspan="1"><p class="c4"><span class="c1">R/W HIGH (read to CPU)</span></p></td><td class="c6" colspan="1" rowspan="1"><p class="c4"><span class="c1">R/W LOW (write from CPU)</span></p></td></tr><tr class="c27"><td class="c30" colspan="1" rowspan="1"><p class="c4"><span class="c1">ADDR</span></p></td><td class="c26" colspan="1" rowspan="1"><p class="c4"><span class="c1">Motherboard: SIPO</span></p><p class="c4"><span class="c1">CPU: PISO</span></p></td><td class="c6" colspan="1" rowspan="1"><p class="c4"><span class="c1">Motherboard: SIPO</span></p><p class="c4"><span class="c1">CPU: PISO</span></p></td></tr><tr class="c27"><td class="c30" colspan="1" rowspan="1"><p class="c4"><span class="c1">DATA</span></p></td><td class="c26" colspan="1" rowspan="1"><p class="c4"><span class="c1">Motherboard: PISO</span></p><p class="c4"><span class="c1">CPU: SIPO</span></p></td><td class="c6" colspan="1" rowspan="1"><p class="c4"><span class="c1">Motherboard: SIPO</span></p><p class="c4"><span class="c1">CPU: PISO</span></p></td></tr></table><p class="c2"><span class="c1"></span></p><p class="c10"><span class="c1">Note that the address is always dictated by the CPU - a peripheral cannot change the address active.</span></p><h2 class="c0" id="h.1ksv4uv"><span class="c13 c8">Implementing PBI on Your System</span></h2><p class="c10"><span class="c20">Operating Voltages</span></p><p class="c10"><span class="c1">The operating voltages on the PBI lane are from 0 to 3.3V. &nbsp;Using 5V will damage the CPUs intended for the standard. This is per the TTL Input High standard voltages. CMOS voltages are not supported. Alternatively, a bidirectional MOSFET level shifter can be used to shift down the bus to 3.3V when it reaches the CPU, and up to 5V as it exits. If 5V logic PBI lanes are used, this must be clearly marked because most peripherals will use 3.3V.</span></p><p class="c10"><span class="c20">Current Sourcing and Sinking</span></p><p class="c10"><span class="c1">The maximum current allowed to be sent down the bus is 16mA. Higher current will damage the CPU pins. The data outputs from the CPU must not be used to source current to power any peripheral, nor should they be used to implement logic (e.g. the diagram shown below is forbidden)</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 400.00px; height: 126.95px;"><img alt="" src="images/image11.png" style="width: 623.99px; height: 350.91px; margin-left: -34.99px; margin-top: -105.92px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c1"></span></p><p class="c2"><span class="c1"></span></p><p class="c2"><span class="c1"></span></p><p class="c2"><span class="c1"></span></p><p class="c2"><span class="c1"></span></p><p class="c10"><span class="c1">This is forbidden because it means the CPU is forced to source the current for the logic, which it simply cannot do.</span></p><p class="c2"><span class="c1"></span></p><p class="c10"><span class="c12 c18">High-Impedance Deselect</span></p><p class="c10"><span>If the address supplied to the peripheral is not correct, then the data inputs should enter high-impedance (high-z) mode. This can be done by tri-state buffering the data inputs. This stops current being sunk to ground when the peripheral is deselected because of its address. Current may flow through the address inputs when the peripheral is deselected, or if the CE / DAL addressing mode is being used.</span><hr style="page-break-before:always;display:none;"></p><h1 class="c33" id="h.44sinio"><span class="c8 c11">Document Revisions</span></h1><p class="c5 subtitle" id="h.2jxsxqh"><span class="c14">Last Standard Revision: Generation 1.0 (April 2023)</span></p><hr style="page-break-before:always;display:none;"><p class="c2"><span class="c1"></span></p><p class="c2"><span class="c1"></span></p><a id="t.65dfce3ceaf88aa42e137dba08500b788309d1d7"></a><a id="t.2"></a><table class="c38"><tr class="c27"><td class="c3" colspan="1" rowspan="1"><p class="c4 c34"><span class="c1"></span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c12 c18">PBI Generation 1</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c12 c18">PBI Generation 2</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c12 c18">PBI Generation 3</span></p></td></tr><tr class="c27"><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Data Transfer Rate</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Simplex</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Simplex</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Full duplex</span></p></td></tr><tr class="c27"><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Data Transfer Type</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Parallel</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Parallel</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Dual differential serial</span></p></td></tr><tr class="c27"><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Peripheral addresses</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Hardware-fixed</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Dynamic</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Dynamic</span></p></td></tr><tr class="c27"><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Interrupts?</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">No</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">No</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Yes</span></p></td></tr><tr class="c27"><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Power over the bus?</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">No</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">No</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Yes, 3.3V, 5V and 12V power</span></p></td></tr><tr class="c27"><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">No of pins on connector</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">21 or 23</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">23 or 25</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">15</span></p></td></tr><tr class="c27"><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">Suggested clock speed</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">25 MHz</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">50 MHz</span></p></td><td class="c3" colspan="1" rowspan="1"><p class="c4"><span class="c1">100 MHz</span></p></td></tr></table><p class="c2"><span class="c1"></span></p><p class="c10"><span class="c1">4 twisted pair serial wires (2 DATA (CTX+, CTX-, CRX+, CRX-) , 2 CLOCK (TXK+, TXK-, RXK+, RXK-)).</span></p><p class="c10"><span class="c1">4 power wires (12V, 3V3, 5V, GND)</span></p><p class="c10"><span>2 join control wires ( </span><img src="images/image4.png"><span>, </span><img src="images/image5.png"><span class="c1">)</span></p><p class="c10"><span>2 interrupt wires (</span><img src="images/image6.png"><span>, &nbsp;</span><img src="images/image7.png"><span class="c1">)</span></p><p class="c10"><span class="c1">Join goes LOW &rarr; CPU stops &rarr; when CPU ready, address sent off CTX with RESP LOW. This is picked up by the peripheral, which knows that this is the address to switch to. other peripherals, seeing RESP low, ignore the data.</span></p><p class="c2"><span class="c1"></span></p><p class="c10"><img src="images/image8.png"></p><p class="c10"><img src="images/image9.png"></p><p class="c2"><span class="c1"></span></p><p class="c2"><span class="c1"></span></p><p class="c2"><span class="c1"></span></p><p class="c2"><span class="c1"></span></p><div><p class="c2"><span class="c1"></span></p></div></body></html>